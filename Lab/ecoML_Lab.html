<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jeremy Forsythe">

<title>ecoML Workshop Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ecoML_Lab_files/libs/clipboard/clipboard.min.js"></script>
<script src="ecoML_Lab_files/libs/quarto-html/quarto.js"></script>
<script src="ecoML_Lab_files/libs/quarto-html/popper.min.js"></script>
<script src="ecoML_Lab_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ecoML_Lab_files/libs/quarto-html/anchor.min.js"></script>
<link href="ecoML_Lab_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ecoML_Lab_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ecoML_Lab_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ecoML_Lab_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ecoML_Lab_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ecoML Workshop Lab</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jeremy Forsythe </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="quick-intro" class="level2">
<h2 class="anchored" data-anchor-id="quick-intro">Quick Intro</h2>
<p>The lab is written in Quarto, which uses successive chunks of code to iterate through many machine learning models and compare the results.</p>
<p>You will start with one dataset and a goal of regression. From there you will run a sequence of models, and look at performance metrics to decide which machine learning model is best suited for the data.</p>
<p>You can proceed however you would like through learning the different methods, but my suggestion is to run the code line by line to understand what is happening at each step.</p>
<p>Lastly there is an optional section to install Tensorflow for regression and image classification.</p>
<p>To begin, let’s get the packages we need.</p>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>There are MANY packages that have accumulated over the years for machine learning in R. Fortunately, the developers behind CARET recognized there was a need for a single package to bring them all together. CARET uses wrapper functions and some clever coding to make machine learning tasks fast and easier in the R language by using the same simple syntax for almost all of our machine learning needs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Only Need To Run This Once</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"caret"</span>,                 <span class="co"># Primary Machine Learning Package in R</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"adabag"</span>,                <span class="co"># For Random Forest Bagging</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"glmnet"</span>,                <span class="co"># For Generalized Linear Modeling </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"neuralnet"</span>,             <span class="co"># For Neural Networks</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"e1071"</span>,                 <span class="co"># For Support Vector Machines</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"pls"</span>,                   <span class="co"># For Principal Component Regression</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"randomForest"</span>,          <span class="co"># For Random Forests</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"gbm"</span>,                   <span class="co"># For Gradient Boosting </span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"xgboost"</span>,               <span class="co"># For Extreme Gradient Boosting</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"kernlab"</span>,               <span class="co"># For Support Vector Machines</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"shapr"</span>,                 <span class="co"># For Visualizations</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"PerformanceAnalytics"</span>,  <span class="co"># Assessing Model Performance </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"RANN"</span>,                  <span class="co"># Data Preprocessing (Imputation)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"purrr"</span>,                 <span class="co"># Extended Functionality For Processing Data</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"tidyr"</span>,                 <span class="co"># Extended Functionality For Processing Data</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"reshape2"</span>,              <span class="co"># For Data Manipulation</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"plotmo"</span>,                <span class="co"># For Visualizations</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"naniar"</span>,                <span class="co"># For Visualizations</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"UpSetR"</span>,                <span class="co"># For Visualizations</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"GGally"</span>,                <span class="co"># For Visualizations</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"ggplot2"</span>,               <span class="co"># For Visualizations</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"rattle"</span>,                <span class="co"># For Visualizations</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"kernelshap"</span>,            <span class="co"># For Visualizations</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"shapviz"</span>,               <span class="co"># For Visualizations</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"xtable"</span>                 <span class="co"># For Printing RMarkdown Tables</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">############ Library Loading</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rattle)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adabag)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PerformanceAnalytics)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotmo)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(neuralnet)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(UpSetR)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RANN)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pls)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gbm)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kernelshap)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shapviz)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kernlab)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xtable)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">xtable.comment =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>) <span class="co"># Forces our random numbers to be reproducible</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>Our main goal for today is analyze some eddy covariance flux data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>flux<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/JeremyDForsythe/PersonalWebsite/master/content/teaching/MachineLearningInR/US-SB3_2023_Example.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(flux)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TIMESTAMP_END" "NEE"           "SW_IN"         "TA"           
[5] "VPD"           "SWC"          </code></pre>
</div>
</div>
<p>The data has time information (TIMESTAMP_END), Net Ecosystem Exchange (NEE), and some of the common drivers of photosynthesis: Incoming Solar Radiation (SW_IN), Air Temperature (TA), Vapor Pressure Deficit (VPD), and Soil Moisture (SWC).</p>
<p>First, let’s tell R that TIMESTAMP_END is date and time information:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>flux<span class="sc">$</span>TIMESTAMP_END<span class="ot">&lt;-</span><span class="fu">as.POSIXct</span>(<span class="fu">as.character</span>(flux<span class="sc">$</span>TIMESTAMP_END), </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">tz=</span><span class="st">"EST"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next let’s look at NEE (NOTE: NEE follows the atmospheric sign convention and is negative when carbon is going into the plants from the atmosphere.):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(NEE<span class="sc">~</span>TIMESTAMP_END, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> flux, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">'cornflowerblue'</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">''</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"NEE ("</span>, mu, <span class="st">"mol CO2 m-2 s-1)"</span>)))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">col =</span> <span class="st">'indianred'</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s look at the other variables to get to know our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TA<span class="sc">~</span>TIMESTAMP_END, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> flux, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"plum"</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">''</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Air Temperature (Deg C)"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(SW_IN<span class="sc">~</span>TIMESTAMP_END, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> flux, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"darkorange1"</span>, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">''</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Incoming Shortwave (W m-2)"</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(VPD<span class="sc">~</span>TIMESTAMP_END, </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> flux, </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"firebrick4"</span>, </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">''</span>, </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Vapor Pressure Deficit (hPa)"</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(SWC<span class="sc">~</span>TIMESTAMP_END, </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> flux, </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"dodgerblue3"</span>, </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">''</span>, </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Soil Water Content (%)"</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>flux <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(value)) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> key, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 691 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing">Data Preprocessing</h2>
<section id="dealing-with-nas" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-nas">Dealing With NAs</h3>
<p>Eddy Covariance is a great tool for making timeseries of fluxes and weather variables, but occasionally something goes wrong at the sensor and the data is bad (represented as NA in our data).</p>
<p>We are going to do both prediction and inference with this data by analyzing the important drivers of NEE using Machine Learning and using those drivers to gap fill NEE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>target<span class="ot">&lt;-</span><span class="st">"NEE"</span> <span class="co"># Could be multiple targets</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>predictors<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"SW_IN"</span>,<span class="st">"VPD"</span>,<span class="st">"TA"</span>,<span class="st">"SWC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next let’s look at the data gaps in the target:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(flux[target], <span class="at">warn_large_data =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now the predictors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(flux[predictors], <span class="at">warn_large_data =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>One of our predictors also has missing data, SWC is missing 1%. We now have a choice to make. We can exclude those rows, or “impute” the data which is a form of gapfilling. Imputation preserves all cases by replacing missing data with an estimated value based on other available information. I wouldn’t normally impute soil moisture from temperature, sunlight, and VPD but for the sake of showing you, that’s what I am going to do. Be careful with this choice though, and make sure you can back it up scientifically. When in doubt, remove the rows with any NAs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Impute To Gapfill NAs in Predictor Datasets with K-Nearest Neighbor Imputation</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>PreImputeKNN <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(flux[predictors],<span class="at">method=</span><span class="st">"knnImpute"</span>,<span class="at">k=</span><span class="dv">5</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>DataImputeKNN <span class="ot">&lt;-</span> <span class="fu">predict</span>(PreImputeKNN, flux[predictors]) <span class="co"># Note: Standardizes the Data</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>Rescale<span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">t</span>(DataImputeKNN)<span class="sc">*</span>PreImputeKNN<span class="sc">$</span>std<span class="sc">+</span>PreImputeKNN<span class="sc">$</span>mean)) <span class="co">#Convert back to original scale</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>ImputeFlux<span class="ot">&lt;-</span><span class="fu">cbind</span>(flux[target],Rescale)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(PreImputeKNN,DataImputeKNN,Rescale)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(ImputeFlux, <span class="at">warn_large_data =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">### For Model Training Remove NAs in Target</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>Impute<span class="ot">&lt;-</span>ImputeFlux[<span class="fu">complete.cases</span>(ImputeFlux), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-partitioning" class="level3">
<h3 class="anchored" data-anchor-id="data-partitioning">Data partitioning</h3>
<p>In a typical machine learning problem, you have a data set and you need to create a model which predicts the outcomes.</p>
<p>You can use all the available data for training the model (that is, learning the associations between the data and the outcomes), and</p>
<p>then you can just keep your fingers crossed and hope that your model will perform well when it will be applied to data that it has never seen before.</p>
<p>A more realistic behavior is to reserve some of the data for testing the model. That is, you split the data into two sets: a training set and a testing set.</p>
<p>You use the training set to train the model, and then you apply the test set to get an estimate on how well the model works on the data that were not used for training. This is called cross-validation.</p>
<p>It is absolutely critical that the training and test sets are completely independent. Otherwise, when you test your model, your prediction accuracy will be artificially high – not because your model is good, but because there is some correlation between the training and test sets.</p>
<p>The more data you have for training, the more hope you can have that the model will accurately capture the relationships between the inputs and the outcomes. The more data you have for testing, the more accurate is your estimate on how well your model generalizes. So splitting the data into training and test sets is not a trivial task, with a lot of research performed on it. Some strategies are:</p>
<ul>
<li>leave-one-out cross-validation (“LOO”). Here, we maximize the training set: only one observation is used for test, and remaining observations are used for training. This is done in a loop, so each observation gets its turn to be in the test set. This procedure is common when you work with small datasets.</li>
<li>80-20 split: 80% of the data are used for training, and 20% for testing. Again, this is done in a loop. One strategy is to get a random sample of 20% of the data, in a loop; at the next iteration, you can get another random sample of 20% etc. Another strategy is to first use the first 20%, at the next iteration you use the next 20%, etc; this way, you can have 5 iterations to go through the whole data set. This is also called 5-fold cross-validation.</li>
<li>A general idea of k-fold cross-validation is to break up the data into k chunks and, at each iteration, use one of the chunks for testing and the rest of the data for training.</li>
<li>split-half: the data are evenly split into training and test sets. First, you use on half for training and the other for testing; second, you use the second half for training and the first half for testing. The amount of training data is relatively small, but this way is sometimes used if the stability of the model is just as important as the classification accuracy.</li>
</ul>
<p>For today’s example we are going to randomly split 60% data for training and keep the rest for testing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>partitionIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y=</span>Impute<span class="sc">$</span>NEE,<span class="at">p=</span><span class="fl">0.6</span>,<span class="at">list=</span><span class="cn">FALSE</span>,<span class="at">times=</span><span class="dv">1</span>) <span class="co">#Create the index of 'keeps'</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> Impute[partitionIndex,] <span class="co"># Convert 'keeps' to Training</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>testing  <span class="ot">&lt;-</span> Impute[<span class="sc">-</span>partitionIndex,] <span class="co"># The Rest to Testing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then using K-fold: Cross validation approach to skip the validation set. The procedure has a single parameter called k that refers to the number of groups that a given data sample is to be split into. For more info visit : https://scikit-learn.org/stable/modules/cross_validation.html</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fitControl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">"cv"</span>, <span class="at">number=</span><span class="dv">10</span>, <span class="at">allowParallel =</span> <span class="cn">TRUE</span>) <span class="co">#in this case k=10 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="begin-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="begin-machine-learning">Begin Machine Learning</h2>
<p>Models are quite numerous: Check http://topepo.github.io/caret/train-models-by-tag.html for all options!</p>
<section id="linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="linear-regression">Linear Regression</h3>
<p>Let’s start simple with linear regression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span>., <span class="at">data=</span>training, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">trControl=</span>fitControl, <span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize results</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

4160 samples
   4 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 3744, 3744, 3744, 3744, 3744, 3744, ... 
Resampling results:

  RMSE      Rsquared   MAE     
  4.243409  0.6638726  3.200485

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the Regression Model</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(prediction_test,testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           NEE      SW_IN        VPD         TA       SWC
[1,] 0.8146539 -0.9603192 -0.4873968 -0.5101224 0.2968282</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(prediction_test,testing<span class="sc">$</span>NEE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  prediction_test and testing$NEE
t = 73.904, df = 2768, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.8017357 0.8268113
sample estimates:
      cor 
0.8146539 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.2405246 0.6635506 3.1967113 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    RMSE Rsquared      MAE 
4.246887 0.663661 3.187083 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Output=</span><span class="st">'NEE'</span>, <span class="at">Model=</span><span class="st">'LinearRegression'</span>, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">TrainRMSE =</span> <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">TestRMSE =</span> <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">TrainR2 =</span> <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">TestR2 =</span> <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]])</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stepwise-linear-regression-based-on-aic" class="level3">
<h3 class="anchored" data-anchor-id="stepwise-linear-regression-based-on-aic">Stepwise Linear Regression based on AIC</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span>., <span class="at">data=</span>training,<span class="at">method=</span><span class="st">"lmStepAIC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=12160.13
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                77186 12160
- TA     1      2650  79836 12298
- SWC    1      5653  82839 12452
- VPD    1      5936  83122 12466
- SW_IN  1     98474 175661 15579
Start:  AIC=12083.68
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                75781 12084
- TA     1      2719  78500 12228
- SWC    1      6154  81934 12406
- VPD    1      6628  82409 12430
- SW_IN  1    104593 180373 15689
Start:  AIC=11910.62
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                72693 11911
- TA     1      2982  75674 12076
- VPD    1      5576  78269 12216
- SWC    1      6305  78998 12255
- SW_IN  1    104731 177424 15621
Start:  AIC=12014.7
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                74534 12015
- TA     1      2959  77493 12175
- VPD    1      4971  79506 12281
- SWC    1      5136  79671 12290
- SW_IN  1    100460 174995 15563
Start:  AIC=11923.84
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                72924 11924
- TA     1      2770  75694 12077
- VPD    1      5279  78203 12213
- SWC    1      5440  78364 12221
- SW_IN  1    102218 175142 15567
Start:  AIC=12200.33
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                77936 12200
- TA     1      2464  80399 12328
- VPD    1      5442  83377 12479
- SWC    1      5589  83525 12486
- SW_IN  1    103996 181932 15725
Start:  AIC=12104.95
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                76169 12105
- TA     1      2886  79056 12258
- SWC    1      4640  80809 12349
- VPD    1      5298  81467 12383
- SW_IN  1    100819 176988 15610
Start:  AIC=11889.25
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                72320 11889
- TA     1      2384  74704 12022
- VPD    1      4912  77233 12161
- SWC    1      6309  78629 12235
- SW_IN  1    107343 179664 15673
Start:  AIC=12094.8
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                75983 12095
- TA     1      3338  79322 12272
- SWC    1      6336  82319 12426
- VPD    1      7220  83204 12470
- SW_IN  1    107795 183779 15767
Start:  AIC=11872.75
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                72034 11873
- TA     1      2887  74921 12034
- VPD    1      5638  77672 12184
- SWC    1      6994  79028 12256
- SW_IN  1     99983 172017 15492
Start:  AIC=12072.68
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                75580 12073
- TA     1      3532  79112 12261
- VPD    1      5827  81407 12380
- SWC    1      5838  81418 12380
- SW_IN  1     97643 173224 15521
Start:  AIC=12143.08
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                76870 12143
- TA     1      3030  79900 12302
- VPD    1      5052  81923 12406
- SWC    1      6912  83783 12499
- SW_IN  1     94533 171403 15477
Start:  AIC=11913.47
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                72742 11914
- TA     1      3297  76039 12096
- SWC    1      5498  78241 12215
- VPD    1      6076  78818 12245
- SW_IN  1    104096 176839 15607
Start:  AIC=11853.98
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                71710 11854
- TA     1      2164  73874 11976
- VPD    1      5212  76921 12144
- SWC    1      6039  77749 12188
- SW_IN  1    100535 172244 15497
Start:  AIC=12190.35
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                77749 12190
- TA     1      2556  80304 12323
- VPD    1      5234  82983 12459
- SWC    1      5876  83625 12491
- SW_IN  1    105100 182848 15746
Start:  AIC=11964.63
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                73643 11965
- TA     1      2262  75905 12088
- VPD    1      4839  78482 12227
- SWC    1      6343  79985 12306
- SW_IN  1    100144 173787 15534
Start:  AIC=12165.22
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                77281 12165
- TA     1      3738  81019 12360
- SWC    1      5039  82320 12426
- VPD    1      5898  83178 12469
- SW_IN  1    105459 182739 15743
Start:  AIC=11883.87
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                72227 11884
- TA     1      2686  74912 12034
- VPD    1      5046  77272 12163
- SWC    1      5639  77866 12195
- SW_IN  1    100454 172681 15508
Start:  AIC=12149.9
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                76997 12150
- TA     1      2198  79195 12265
- VPD    1      4949  81946 12407
- SWC    1      6827  83823 12501
- SW_IN  1    105604 182601 15740
Start:  AIC=12131.15
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                76650 12131
- TA     1      2682  79333 12272
- SWC    1      5448  82098 12415
- VPD    1      6355  83006 12460
- SW_IN  1    103060 179710 15674
Start:  AIC=11998.21
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                74240 11998
- TA     1      3353  77593 12180
- VPD    1      4935  79174 12264
- SWC    1      5184  79423 12277
- SW_IN  1     98468 172707 15508
Start:  AIC=12171.45
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                77396 12171
- TA     1      3004  80401 12328
- SWC    1      4011  81407 12380
- VPD    1      4278  81674 12393
- SW_IN  1     96199 173595 15530
Start:  AIC=11987.66
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                74052 11988
- TA     1      2478  76529 12123
- VPD    1      4335  78386 12222
- SWC    1      5906  79957 12305
- SW_IN  1     96355 170407 15453
Start:  AIC=12120.73
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                76459 12121
- TA     1      3322  79780 12296
- VPD    1      5437  81896 12404
- SWC    1      5606  82064 12413
- SW_IN  1    101455 177913 15632
Start:  AIC=11920.87
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                72872 11921
- TA     1      2177  75049 12041
- VPD    1      4402  77274 12163
- SWC    1      5104  77976 12200
- SW_IN  1     99219 172091 15494
Start:  AIC=12029.8
.outcome ~ SW_IN + VPD + TA + SWC

        Df Sum of Sq    RSS   AIC
&lt;none&gt;                74805 12030
- TA     1      2637  77443 12172
- VPD    1      4993  79798 12297
- SWC    1      5651  80456 12331
- SW_IN  1    100565 175370 15572</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="sc">$</span>finalModel) <span class="co"># Note: The 'stars' next to the input indicate the statistical sig.  </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ SW_IN + VPD + TA + SWC, data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-33.890  -2.332   0.026   2.626  24.614 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -7.4547018  0.6414547  -11.62   &lt;2e-16 ***
SW_IN       -0.0231832  0.0003102  -74.74   &lt;2e-16 ***
VPD          0.2215387  0.0133031   16.65   &lt;2e-16 ***
TA          -0.1338860  0.0110620  -12.10   &lt;2e-16 ***
SWC          0.3500392  0.0197581   17.72   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.243 on 4155 degrees of freedom
Multiple R-squared:  0.6636,    Adjusted R-squared:  0.6632 
F-statistic:  2049 on 4 and 4155 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the Regression Model</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(prediction_test,testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           NEE      SW_IN        VPD         TA       SWC
[1,] 0.8146539 -0.9603192 -0.4873968 -0.5101224 0.2968282</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(prediction_test,testing<span class="sc">$</span>NEE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  prediction_test and testing$NEE
t = 73.904, df = 2768, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.8017357 0.8268113
sample estimates:
      cor 
0.8146539 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.2405246 0.6635506 3.1967113 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    RMSE Rsquared      MAE 
4.246887 0.663661 3.187083 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"StepWiseRegression"</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="polynomial-regression-with-degree-of-freedom3" class="level3">
<h3 class="anchored" data-anchor-id="polynomial-regression-with-degree-of-freedom3">Polynomial Regression with degree of freedom=3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span><span class="fu">poly</span>(SW_IN,<span class="dv">3</span>)<span class="sc">+</span><span class="fu">poly</span>(TA,<span class="dv">3</span>)<span class="sc">+</span><span class="fu">poly</span>(SWC,<span class="dv">3</span>)<span class="sc">+</span><span class="fu">poly</span>(VPD,<span class="dv">3</span>),</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>training, <span class="at">preProcess=</span><span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>), <span class="at">method=</span><span class="st">"lm"</span>) </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># method = "center" subtracts the mean of the predictor's data from the data in x from the predictor values while method = "scale" divides by the standard deviation.</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="sc">$</span>finalModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-36.301  -2.273   0.262   2.563  24.690 

Coefficients:
                  Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)       -7.72075    0.06099 -126.600  &lt; 2e-16 ***
`poly(SW_IN, 3)1` -5.75695    0.07694  -74.819  &lt; 2e-16 ***
`poly(SW_IN, 3)2`  0.67108    0.06423   10.448  &lt; 2e-16 ***
`poly(SW_IN, 3)3` -0.16030    0.06121   -2.619 0.008858 ** 
`poly(TA, 3)1`    -1.14439    0.08485  -13.487  &lt; 2e-16 ***
`poly(TA, 3)2`    -0.40661    0.06642   -6.122 1.01e-09 ***
`poly(TA, 3)3`     0.31608    0.06299    5.018 5.45e-07 ***
`poly(SWC, 3)1`    1.28228    0.06538   19.612  &lt; 2e-16 ***
`poly(SWC, 3)2`   -0.22715    0.06192   -3.669 0.000247 ***
`poly(SWC, 3)3`   -0.27620    0.06198   -4.457 8.55e-06 ***
`poly(VPD, 3)1`    1.45410    0.09129   15.928  &lt; 2e-16 ***
`poly(VPD, 3)2`    1.22566    0.06713   18.259  &lt; 2e-16 ***
`poly(VPD, 3)3`   -0.49102    0.06494   -7.561 4.89e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.933 on 4147 degrees of freedom
Multiple R-squared:  0.7114,    Adjusted R-squared:  0.7106 
F-statistic: 851.9 on 12 and 4147 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the Regression Model</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(prediction_test,testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           NEE      SW_IN        VPD         TA       SWC
[1,] 0.8417282 -0.9318814 -0.4751798 -0.4872013 0.2864477</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(prediction_test,testing<span class="sc">$</span>NEE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  prediction_test and testing$NEE
t = 82.024, df = 2768, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.8305208 0.8522542
sample estimates:
      cor 
0.8417282 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.9272879 0.7114201 2.9927108 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.9543190 0.7085063 3.0083919 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"PolynomialRegression"</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="principal-component-regression" class="level3">
<h3 class="anchored" data-anchor-id="principal-component-regression">Principal Component Regression</h3>
<p>Linear Regression using the output of a Principal Component Analysis (PCA). PCR is skillful when data has lots of highly correlated predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span>.,<span class="at">data=</span>training,<span class="at">method=</span><span class="st">"pcr"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="sc">$</span>finalModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data:   X dimension: 4160 4 
    Y dimension: 4160 1
Fit method: svdpc
Number of components considered: 3
TRAINING: % variance explained
          1 comps  2 comps  3 comps
X           99.86    99.96    99.98
.outcome    60.98    61.16    64.34</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the Regression Model</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(prediction_test,testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          NEE      SW_IN        VPD         TA       SWC
[1,] 0.802608 -0.9742315 -0.4963897 -0.5343393 0.1431808</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(prediction_test,testing<span class="sc">$</span>NEE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  prediction_test and testing$NEE
t = 70.79, df = 2768, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.7889479 0.8154751
sample estimates:
     cor 
0.802608 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.3655942 0.6434115 3.2695168 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.3678747 0.6441796 3.2232354 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"PCARegression"</span>,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="decision-trees" class="level3">
<h3 class="anchored" data-anchor-id="decision-trees">Decision Trees</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span>.,<span class="at">data=</span>training,<span class="at">method=</span><span class="st">"rpart"</span>,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">parms =</span> <span class="fu">list</span>(<span class="at">split =</span> <span class="st">"ginni"</span>)) <span class="co"># ginni can be replaced by chisquare, entropy, information</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo,
: There were missing values in resampled performance measures.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fancyRpartPlot</span>(model<span class="sc">$</span>finalModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(prediction_test,testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           NEE      SW_IN        VPD         TA        SWC
[1,] 0.7368412 -0.9304544 -0.5518993 -0.4079882 0.08495264</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(prediction_test,testing<span class="sc">$</span>NEE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  prediction_test and testing$NEE
t = 57.341, df = 2768, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.7193385 0.7534089
sample estimates:
      cor 
0.7368412 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.8980837 0.5511171 3.8096627 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.9506771 0.5429349 3.8149195 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"DecisionTree"</span>,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="random-forest" class="level3">
<h3 class="anchored" data-anchor-id="random-forest">Random Forest</h3>
<p>Use bootstrapping technique to grow multiple trees:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span>.,<span class="at">data=</span>training,<span class="at">method=</span><span class="st">"rf"</span>,<span class="at">trControl =</span> fitControl) <span class="co"># This takes a LONG time </span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(prediction_test,testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           NEE      SW_IN        VPD         TA       SWC
[1,] 0.9019696 -0.8729649 -0.4644515 -0.4689101 0.2562649</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(prediction_test,testing<span class="sc">$</span>NEE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  prediction_test and testing$NEE
t = 109.9, df = 2768, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.8947843 0.9086879
sample estimates:
      cor 
0.9019696 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
1.4056881 0.9660806 0.9740779 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.1621687 0.8135491 2.1972323 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"RandomForest"</span>,</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bagging-bootstrap-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="bagging-bootstrap-aggregation">Bagging (Bootstrap Aggregation)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span>.,<span class="at">data=</span>training,</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method=</span><span class="st">"treebag"</span>, <span class="co">#Other methods : bagFDA, ldaBag, plsBag</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">importance=</span><span class="cn">TRUE</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    RMSE Rsquared      MAE 
3.900029 0.716986 2.966323 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.0582118 0.6932847 3.0398367 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"Bagging"</span>,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gradient-boosting" class="level3">
<h3 class="anchored" data-anchor-id="gradient-boosting">Gradient Boosting</h3>
<p>Ensemble of shallow and weak successive trees, with each tree learning and improving on the previous.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>model<span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span>.,<span class="at">data=</span>training,<span class="at">method=</span><span class="st">"gbm"</span>,<span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>finalModel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A gradient boosted model with gaussian loss function.
150 iterations were performed.
There were 4 predictors of which 4 had non-zero influence.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    RMSE Rsquared      MAE 
3.167317 0.812826 2.327787 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    RMSE Rsquared      MAE 
3.417762 0.782150 2.490415 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"Gradient Boosting"</span>,</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="neural-network" class="level3">
<h3 class="anchored" data-anchor-id="neural-network">Neural Network</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#scale the data set</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>smax <span class="ot">&lt;-</span> <span class="fu">apply</span>(training,<span class="dv">2</span>,max)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>smin <span class="ot">&lt;-</span> <span class="fu">apply</span>(training,<span class="dv">2</span>,min)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>trainNN <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(training,<span class="at">center=</span>smin,<span class="at">scale=</span>smax<span class="sc">-</span>smin))</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>testNN <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(testing,<span class="at">center=</span>smin,<span class="at">scale=</span>smax<span class="sc">-</span>smin))</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the Neural Network using 2 hidden layers (first with 4 neurons, second with 2) using backpropagation:</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>model<span class="ot">&lt;-</span><span class="fu">neuralnet</span>(NEE<span class="sc">~</span>.,trainNN,<span class="at">hidden=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>),<span class="at">linear.output =</span> T) <span class="co"># Takes A Minute</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Predict using Neural Network</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>predictNN <span class="ot">&lt;-</span> <span class="fu">compute</span>(model,trainNN)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>prediction_train <span class="ot">&lt;-</span> predictNN<span class="sc">$</span>net.result<span class="sc">*</span>(smax<span class="sc">-</span>smin)[<span class="dv">1</span>]<span class="sc">+</span>smin[<span class="dv">1</span>]</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>predictNN <span class="ot">&lt;-</span> <span class="fu">compute</span>(model,testNN)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>prediction_test <span class="ot">&lt;-</span> predictNN<span class="sc">$</span>net.result<span class="sc">*</span>(smax<span class="sc">-</span>smin)[<span class="dv">1</span>]<span class="sc">+</span>smin[<span class="dv">1</span>]</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.2848470 0.7981118 2.3872646 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.3781342 0.7873408 2.4325718 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"NeuralNetwork"</span>,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model,prediction_test,prediction_train, predictNN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="support-vector-machines---linear" class="level3">
<h3 class="anchored" data-anchor-id="support-vector-machines---linear">Support Vector Machines - Linear</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span><span class="fu">train</span>(NEE<span class="sc">~</span>.,training,<span class="at">method=</span><span class="st">"svmLinear"</span>,<span class="at">preProc=</span><span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>))</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.2717339 0.6633457 3.1639111 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.2723473 0.6635428 3.1353015 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"svmLinear"</span>,</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="support-vector-machines---poly" class="level3">
<h3 class="anchored" data-anchor-id="support-vector-machines---poly">Support Vector Machines - Poly</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span><span class="fu">train</span>(NEE<span class="sc">~</span>.,training,<span class="at">method=</span><span class="st">"svmPoly"</span>,<span class="at">preProc=</span><span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>)) <span class="co">#This takes a minute!</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.3977032 0.7863881 2.4153756 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    RMSE Rsquared      MAE 
3.491531 0.775179 2.484417 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"svmPoly"</span>,</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="support-vector-machines---radial" class="level3">
<h3 class="anchored" data-anchor-id="support-vector-machines---radial">Support Vector Machines - Radial</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span><span class="fu">train</span>(NEE<span class="sc">~</span>.,training,<span class="at">method=</span><span class="st">"svmRadial"</span>,<span class="at">preProc=</span><span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>)) <span class="co">#This takes a second </span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Other Methods: “svmRadialCost”, “svmRadialSigma”</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.1622088 0.8151874 2.1889145 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.2975994 0.7988787 2.2846207 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"svmRadial"</span>,</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="knn" class="level3">
<h3 class="anchored" data-anchor-id="knn">KNN</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span>.,training,<span class="at">method=</span><span class="st">"knn"</span>,<span class="at">preProc=</span><span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>),<span class="at">tuneLength=</span><span class="dv">20</span>) <span class="co">#This takes a little bit.</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    RMSE Rsquared      MAE 
3.165188 0.814557 2.276603 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.3274099 0.7945954 2.3810570 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"KNN"</span>,</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extreme-gradient-boosting" class="level3">
<h3 class="anchored" data-anchor-id="extreme-gradient-boosting">Extreme Gradient Boosting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(NEE<span class="sc">~</span>., <span class="at">data =</span> training, </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"xgbTree"</span>, <span class="co"># or try 'xgbDART'</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">trControl =</span> fitControl,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">verbosity =</span> <span class="dv">0</span>)</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,training)</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
2.4947908 0.8842642 1.8353789 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
3.3135670 0.7955662 2.3621492 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"xgbTree"</span>,</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(model, prediction_test,prediction_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lasso-ridge" class="level3">
<h3 class="anchored" data-anchor-id="lasso-ridge">Lasso &amp; Ridge</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">2</span>, <span class="at">by =</span><span class="fl">0.1</span>) ,  <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="fl">0.5</span>) , <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">25</span>, <span class="dv">1</span>)) <span class="co"># Create a set of lambdas</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda controls the strength of the penalty applied to the model coefficients</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="co"># if lambda is zero, these becomes ordinary linear regression</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>lasso<span class="ot">&lt;-</span><span class="fu">train</span>(NEE<span class="sc">~</span>.,training,</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">'glmnet'</span>, </span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> parameters) ,</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">metric =</span>  <span class="st">"Rsquared"</span>,</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>             ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo,
: There were missing values in resampled performance measures.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in train.default(x, y, weights = w, ...): missing values found in
aggregated results</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>ridge<span class="ot">&lt;-</span><span class="fu">train</span>(NEE<span class="sc">~</span>.,training,</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">'glmnet'</span>, </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> parameters) ,</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">metric =</span>  <span class="st">"Rsquared"</span>,</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>             ) </span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Lasso best lambda: '</span> , lasso<span class="sc">$</span>finalModel<span class="sc">$</span>lambdaOpt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Lasso best lambda: 0.1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso,training)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso,testing)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.2514414 0.6622687 3.1843932 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.2512150 0.6631788 3.1712631 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"Lasso"</span>,</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">'Ridge best lambda: '</span> , ridge<span class="sc">$</span>finalModel<span class="sc">$</span>lambdaOpt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ridge best lambda: 0.5"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>prediction_train<span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge,training)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>prediction_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge,testing)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE) <span class="co">#To get RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.2821987 0.6608285 3.1909440 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
4.2809284 0.6614478 3.1696293 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>Results<span class="ot">&lt;-</span><span class="fu">rbind</span>(Results,<span class="fu">c</span>(<span class="st">"NEE"</span>, <span class="st">"Ridge"</span>,</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">1</span>]],</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_train,training<span class="sc">$</span>NEE)[[<span class="dv">2</span>]],</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">postResample</span>(prediction_test,testing<span class="sc">$</span>NEE)[[<span class="dv">2</span>]]))</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(lasso,ridge,prediction_train,prediction_test,parameters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="results-of-the-regressions" class="level2">
<h2 class="anchored" data-anchor-id="results-of-the-regressions">Results of the Regressions</h2>
<p>Let’s look at the results to see how we did.</p>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>Results<span class="sc">$</span>TrainRMSE<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(Results<span class="sc">$</span>TrainRMSE)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>Results<span class="sc">$</span>TestRMSE<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(Results<span class="sc">$</span>TestRMSE)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>Results<span class="sc">$</span>TrainR2<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(Results<span class="sc">$</span>TrainR2)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>Results<span class="sc">$</span>TestR2<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(Results<span class="sc">$</span>TestR2)</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">xtable</span>(Results),<span class="at">digits=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It might be tempting to use Random Forest, since it has the lowest testing RMSE and highest testing R^2. However, notice the exceptionally high training R^2 and low training RMSE. When going from training to testing the value drop significantly. This is a sure sign of overfitting. Try to look for the best performance values that have little fluctuation from traing to testing. The Neural Network, svmRadial, and KNN all look pretty great. Personally, I would probably pick svmRadial, but you could still make a strong argument for Random Forest. If you wanted to argue solely by best predictive ability.</p>
</section>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations">Visualizations</h2>
<p>If we are going to use machine learning for inference then we can use SHAP plots to visualize the output. Shapley Additive Explanations is a cutting edge and interesting way to make machine learning outputs more interpretable and sheds light inside the “black box”.</p>
<p>The goal of SHAP is to explain the prediction abilities of an instance of x by computing the contribution of each independent variable to the prediction. The SHAP explanation method computes Shapley values from coalitional game theory. The feature values of a data instance act as players in a coalition. Shapley values tell us how to fairly distribute the “payout” (= the prediction) among the features. A player can be an individual feature value, e.g.&nbsp;for tabular data. A player can also be a group of feature values. For example to explain an image, pixels can be grouped to superpixels and the prediction distributed among them.</p>
<p>For more information on how this is implemended in R, see https://cran.r-project.org/web/packages/shapviz/vignettes/basic_use.html.</p>
<p>This process can take a pretty long, so we are going to run it on a simple dataset included in R, “Iris”. Here we are going to use Sepal Length as the target variable and Petal Length, Species, Sepal Width, and Petal Width as predictors.</p>
<p>Let’s take a look at the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(<span class="at">data=</span>iris,<span class="fu">aes</span>(<span class="at">colour=</span>Species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Try running this on your pick for our best model later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  Sepal.Length <span class="sc">~</span> Petal.Length <span class="sc">+</span> Petal.Width <span class="sc">+</span> Sepal.Width, </span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> iris, </span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"svmLinear"</span>,</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">preProc=</span><span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>),</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"none"</span>)</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>xvars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sepal.Width"</span>,<span class="st">"Petal.Length"</span>,<span class="st">"Petal.Width"</span>)</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">kernelshap</span>(fit, iris, predict, <span class="at">bg_X =</span> iris, <span class="at">feature_names =</span> xvars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Exact Kernel SHAP values</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |                                                                      |   1%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |=======                                                               |  11%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |==============                                                        |  21%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=====================                                                 |  31%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |============================                                          |  41%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |===============================                                       |  45%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |===================================                                   |  51%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |==========================================                            |  61%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |=============================================                         |  65%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |========================================================              |  81%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |===============================================================       |  91%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================|  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>sv <span class="ot">&lt;-</span> <span class="fu">shapviz</span>(s)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sv_importance</span>(sv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sv_importance</span>(sv, <span class="at">kind =</span> <span class="st">'beeswarm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="classification-examples" class="level2">
<h2 class="anchored" data-anchor-id="classification-examples">Classification Examples</h2>
<p>For our classification examples we will also use the Iris dataset built into R, but this time try to classify which species of Iris we have based on Petal Length, Petal Width, Sepal Width, and Sepal Length.</p>
<p>Let’s do our first prediction. Let’s predict the species of irises from the 4 variables (sepal / petal width and length). First, let’s train the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>ind1 <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y=</span>iris<span class="sc">$</span>Species,<span class="at">p=</span><span class="fl">0.6</span>,<span class="at">list=</span><span class="cn">FALSE</span>,<span class="at">times=</span><span class="dv">1</span>)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="co">#list=FALSE, prevent returning result as a list</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="co">#times=1 to create one split</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> iris[ind1,]</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>testing  <span class="ot">&lt;-</span> iris[<span class="sc">-</span>ind1,]</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>train_inputs<span class="ot">=</span>training[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>train_outputs<span class="ot">=</span>training[,<span class="dv">5</span>]</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(train_inputs, train_outputs, <span class="at">method=</span><span class="st">"lda"</span>)</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see how the model did. Our metrics are different for classification</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predictions) <span class="co"># Same Counts!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>predictions
    setosa versicolor  virginica 
        20         20         20 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(testing<span class="sc">$</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    setosa versicolor  virginica 
        20         20         20 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(predictions<span class="sc">==</span>testing<span class="sc">$</span>Species)<span class="sc">/</span><span class="fu">length</span>(predictions)<span class="sc">*</span><span class="dv">100</span> <span class="co"># % Accuracy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100</code></pre>
</div>
</div>
<p>Wow! 100% accuracy is really good. Let’s mess around and see what happens with worse performers. Let’s try a Naive Bayes classifier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(train_inputs, train_outputs, <span class="at">method=</span><span class="st">"nb"</span>)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,testing)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>predictions
    setosa versicolor  virginica 
        20         18         22 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(testing<span class="sc">$</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    setosa versicolor  virginica 
        20         20         20 </code></pre>
</div>
</div>
<p>Ahhhh. Looks like it incorrectly classified two versicolor as virginica.</p>
<p>We can visualized this output with a confusion matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(predictions,testing<span class="sc">$</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

            Reference
Prediction   setosa versicolor virginica
  setosa         20          0         0
  versicolor      0         18         0
  virginica       0          2        20

Overall Statistics
                                          
               Accuracy : 0.9667          
                 95% CI : (0.8847, 0.9959)
    No Information Rate : 0.3333          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.95            
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: setosa Class: versicolor Class: virginica
Sensitivity                 1.0000            0.9000           1.0000
Specificity                 1.0000            1.0000           0.9500
Pos Pred Value              1.0000            1.0000           0.9091
Neg Pred Value              1.0000            0.9524           1.0000
Prevalence                  0.3333            0.3333           0.3333
Detection Rate              0.3333            0.3000           0.3333
Detection Prevalence        0.3333            0.3000           0.3667
Balanced Accuracy           1.0000            0.9500           0.9750</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'reshape2'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    smiths</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span> (predictions,testing<span class="sc">$</span>Species)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>cm_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(cm<span class="sc">$</span>table)</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cm_df, <span class="fu">aes</span>(<span class="at">x =</span> Prediction, <span class="at">y =</span> Reference, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_raster</span>() <span class="sc">+</span> <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s do one more because I want to show you how you can automate the process of tuning hyperparameters. Let’s do a KNN classifier, but tell R to go from K=1 to K=25. The Caret train function takes care of creating the validation set and applying these value of K to classify it.</p>
<section id="knn-classifier" class="level3">
<h3 class="anchored" data-anchor-id="knn-classifier">KNN Classifier</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>indT <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y=</span>iris<span class="sc">$</span>Species,<span class="at">p=</span><span class="fl">0.6</span>,<span class="at">list=</span><span class="cn">FALSE</span>)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> iris[indT,]</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>testing  <span class="ot">&lt;-</span> iris[<span class="sc">-</span>indT,]</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>ModFit_KNN <span class="ot">&lt;-</span> <span class="fu">train</span>(Species<span class="sc">~</span>.,training,<span class="at">method=</span><span class="st">"knn"</span>,<span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>))</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ModFit_KNN<span class="sc">$</span>results,<span class="fu">aes</span>(k,Accuracy))<span class="sc">+</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste</span>(<span class="st">"Optimum K is "</span>,ModFit_KNN<span class="sc">$</span>bestTune),</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Accuracy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>predict_KNN<span class="ot">&lt;-</span> <span class="fu">predict</span>(ModFit_KNN,<span class="at">newdata=</span>testing)</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predict_KNN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>predict_KNN
    setosa versicolor  virginica 
        20         20         20 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(testing<span class="sc">$</span>Species,predict_KNN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

            Reference
Prediction   setosa versicolor virginica
  setosa         20          0         0
  versicolor      0         19         1
  virginica       0          1        19

Overall Statistics
                                          
               Accuracy : 0.9667          
                 95% CI : (0.8847, 0.9959)
    No Information Rate : 0.3333          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.95            
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: setosa Class: versicolor Class: virginica
Sensitivity                 1.0000            0.9500           0.9500
Specificity                 1.0000            0.9750           0.9750
Pos Pred Value              1.0000            0.9500           0.9500
Neg Pred Value              1.0000            0.9750           0.9750
Prevalence                  0.3333            0.3333           0.3333
Detection Rate              0.3333            0.3167           0.3167
Detection Prevalence        0.3333            0.3333           0.3333
Balanced Accuracy           1.0000            0.9625           0.9625</code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span> (predict_KNN,testing<span class="sc">$</span>Species)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>cm_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(cm<span class="sc">$</span>table)</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cm_df, <span class="fu">aes</span>(<span class="at">x =</span> Prediction, <span class="at">y =</span> Reference, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_raster</span>() <span class="sc">+</span> <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ecoML_Lab_files/figure-html/unnamed-chunk-36-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Try out other classifiers on your own! For quadratic discriminant, method=‘qda’. For SVM with linear (straight line) decision boundary, you set method = ‘svmLinear’ (you can also specify cost, which is the amount of error you are willing to tolerate). For non-linear boundaries, you can set method to ‘svmPoly’, ‘svmRadial’, etc. – see https://rdrr.io/cran/caret/man/models.html for all the options available in train for classification or regression.</p>
<p>If the number of observations is less than the number of variables, linear and quadratic discriminants won’t work. The way around it is to use principal component analysis (PCA), where we approximate the data with a small orthogonal set of new variables(principal components), each capturing an important trend in the data. This way, if several variables are correlated, they end up in the same principal component. Essentially, our data are approximated ith a small set of principal components; this approximation is then fed into linear or quadratic discriminants. This method is very robust to noise.</p>
</section>
</section>
<section id="bonus-image-classification" class="level2">
<h2 class="anchored" data-anchor-id="bonus-image-classification">BONUS : Image Classification</h2>
<p>To do image classification we need to download a very powerful machine learning tool called Tensorflow. (https://www.tensorflow.org/about)</p>
<p>TensorFlow is a free and open-source software library for machine learning and artificial intelligence developed by Google. It can be used across a range of tasks but has a particular focus on training and inference of deep neural networks.</p>
<p>Tensorflow has a lot of requirements to get up and running, so no pressure to install of this on your computer if you are low on memory or don’t have a use for using this in your day to day analyses. From here on out the chunks are set to eval=FALSE so you will need to run them manually. My suggestion is to carefully run these line by line. If you already have Python, some of these steps are not neccasary. Check in with me if you are unsure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'tensorflow'</span>) <span class="co"># Install The Tensorflow Package </span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="co"># note this isn't actually the tensorflow software just an R package that makes calls to it.</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'reticulate'</span>) <span class="co"># Package that connects R and Python</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">install_python</span>() <span class="co"># Install Python</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tensorflow) <span class="co"># Load Tensorflow R Package</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="co">#use_python("/usr/bin/python3") Just For Linux</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install_tensorflow</span>(<span class="at">extra_packages=</span><span class="st">"pillow"</span>)</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"keras"</span>) <span class="co"># Install keras Package For Image Classification</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="fu">install_keras</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tensorflow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">timeout=</span><span class="dv">800</span>)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">'https://raw.githubusercontent.com/JeremyDForsythe/PersonalWebsite/master/content/teaching/MachineLearningInR/Data/barnOwltoTest.jpg'</span>,<span class="st">'barnOwltoTest.jpg'</span>)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually download the zip file into your working directory and unzip it. </span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="co"># https://raw.githubusercontent.com/JeremyDForsythe/PersonalWebsite/master/content/teaching/MachineLearningInR/Data/birdArchive.zip</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>path_train <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/birdArchive/train/"</span>)</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>label_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(path_train)</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>output_n <span class="ot">&lt;-</span> <span class="fu">length</span>(label_list)</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(label_list, <span class="at">file=</span><span class="st">"label_list.R"</span>)</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>width <span class="ot">&lt;-</span> <span class="dv">224</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>height<span class="ot">&lt;-</span> <span class="dv">224</span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>target_size <span class="ot">&lt;-</span> <span class="fu">c</span>(width, height)</span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a>rgb <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co">#color channels</span></span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>train_data_gen <span class="ot">&lt;-</span> <span class="fu">image_data_generator</span>(<span class="at">rescale =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">255</span>, </span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation_split =</span> .<span class="dv">2</span>)</span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a>train_images <span class="ot">&lt;-</span> <span class="fu">flow_images_from_directory</span>(path_train,</span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a>  train_data_gen,</span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> <span class="st">'training'</span>,</span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_size =</span> target_size,</span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_mode =</span> <span class="st">"categorical"</span>,</span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">shuffle=</span>F,</span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">classes =</span> label_list,</span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size=</span><span class="dv">1</span>,</span>
<span id="cb176-28"><a href="#cb176-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">2021</span>)</span>
<span id="cb176-29"><a href="#cb176-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-30"><a href="#cb176-30" aria-hidden="true" tabindex="-1"></a>validation_images <span class="ot">&lt;-</span> <span class="fu">flow_images_from_directory</span>(path_train,</span>
<span id="cb176-31"><a href="#cb176-31" aria-hidden="true" tabindex="-1"></a> train_data_gen, </span>
<span id="cb176-32"><a href="#cb176-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> <span class="st">'validation'</span>,</span>
<span id="cb176-33"><a href="#cb176-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_size =</span> target_size,</span>
<span id="cb176-34"><a href="#cb176-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_mode =</span> <span class="st">"categorical"</span>,</span>
<span id="cb176-35"><a href="#cb176-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">classes =</span> label_list,</span>
<span id="cb176-36"><a href="#cb176-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size=</span><span class="dv">1</span>,</span>
<span id="cb176-37"><a href="#cb176-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">2021</span>)</span>
<span id="cb176-38"><a href="#cb176-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-39"><a href="#cb176-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.raster</span>(train_images[[<span class="dv">1</span>]][[<span class="dv">1</span>]][<span class="dv">1</span>,,,]))</span>
<span id="cb176-40"><a href="#cb176-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-41"><a href="#cb176-41" aria-hidden="true" tabindex="-1"></a>mod_base <span class="ot">&lt;-</span> <span class="fu">application_xception</span>(<span class="at">weights =</span> <span class="st">'imagenet'</span>, </span>
<span id="cb176-42"><a href="#cb176-42" aria-hidden="true" tabindex="-1"></a>   <span class="at">include_top =</span> <span class="cn">FALSE</span>, <span class="at">input_shape =</span> <span class="fu">c</span>(width, height, <span class="dv">3</span>))</span>
<span id="cb176-43"><a href="#cb176-43" aria-hidden="true" tabindex="-1"></a><span class="fu">freeze_weights</span>(mod_base) </span>
<span id="cb176-44"><a href="#cb176-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-45"><a href="#cb176-45" aria-hidden="true" tabindex="-1"></a>model_function <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">learning_rate =</span> <span class="fl">0.001</span>, </span>
<span id="cb176-46"><a href="#cb176-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">dropoutrate=</span><span class="fl">0.2</span>, <span class="at">n_dense=</span><span class="dv">1024</span>){</span>
<span id="cb176-47"><a href="#cb176-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb176-48"><a href="#cb176-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">k_clear_session</span>()</span>
<span id="cb176-49"><a href="#cb176-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb176-50"><a href="#cb176-50" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span></span>
<span id="cb176-51"><a href="#cb176-51" aria-hidden="true" tabindex="-1"></a>    mod_base <span class="sc">%&gt;%</span> </span>
<span id="cb176-52"><a href="#cb176-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_global_average_pooling_2d</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb176-53"><a href="#cb176-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="at">units =</span> n_dense) <span class="sc">%&gt;%</span></span>
<span id="cb176-54"><a href="#cb176-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_activation</span>(<span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb176-55"><a href="#cb176-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dropout</span>(dropoutrate) <span class="sc">%&gt;%</span></span>
<span id="cb176-56"><a href="#cb176-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="at">units=</span>output_n, <span class="at">activation=</span><span class="st">"softmax"</span>)</span>
<span id="cb176-57"><a href="#cb176-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb176-58"><a href="#cb176-58" aria-hidden="true" tabindex="-1"></a>  model <span class="sc">%&gt;%</span> <span class="fu">compile</span>(</span>
<span id="cb176-59"><a href="#cb176-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">loss =</span> <span class="st">"categorical_crossentropy"</span>,</span>
<span id="cb176-60"><a href="#cb176-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">optimizer =</span> <span class="fu">optimizer_adam</span>(<span class="at">learning_rate =</span> learning_rate),</span>
<span id="cb176-61"><a href="#cb176-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> <span class="st">"accuracy"</span></span>
<span id="cb176-62"><a href="#cb176-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb176-63"><a href="#cb176-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb176-64"><a href="#cb176-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb176-65"><a href="#cb176-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb176-66"><a href="#cb176-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb176-67"><a href="#cb176-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-68"><a href="#cb176-68" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">model_function</span>()</span>
<span id="cb176-69"><a href="#cb176-69" aria-hidden="true" tabindex="-1"></a>model</span>
<span id="cb176-70"><a href="#cb176-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-71"><a href="#cb176-71" aria-hidden="true" tabindex="-1"></a>batch_size <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb176-72"><a href="#cb176-72" aria-hidden="true" tabindex="-1"></a>epochs <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb176-73"><a href="#cb176-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-74"><a href="#cb176-74" aria-hidden="true" tabindex="-1"></a>path_test <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/birdArchive/test/"</span>)</span>
<span id="cb176-75"><a href="#cb176-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-76"><a href="#cb176-76" aria-hidden="true" tabindex="-1"></a>test_data_gen <span class="ot">&lt;-</span> <span class="fu">image_data_generator</span>(<span class="at">rescale =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">255</span>)</span>
<span id="cb176-77"><a href="#cb176-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-78"><a href="#cb176-78" aria-hidden="true" tabindex="-1"></a>test_images <span class="ot">&lt;-</span> <span class="fu">flow_images_from_directory</span>(path_test,</span>
<span id="cb176-79"><a href="#cb176-79" aria-hidden="true" tabindex="-1"></a>   test_data_gen,</span>
<span id="cb176-80"><a href="#cb176-80" aria-hidden="true" tabindex="-1"></a>   <span class="at">target_size =</span> target_size,</span>
<span id="cb176-81"><a href="#cb176-81" aria-hidden="true" tabindex="-1"></a>   <span class="at">class_mode =</span> <span class="st">"categorical"</span>,</span>
<span id="cb176-82"><a href="#cb176-82" aria-hidden="true" tabindex="-1"></a>   <span class="at">classes =</span> label_list,</span>
<span id="cb176-83"><a href="#cb176-83" aria-hidden="true" tabindex="-1"></a>   <span class="at">shuffle =</span> F,</span>
<span id="cb176-84"><a href="#cb176-84" aria-hidden="true" tabindex="-1"></a>   <span class="at">batch_size=</span><span class="dv">1</span>,</span>
<span id="cb176-85"><a href="#cb176-85" aria-hidden="true" tabindex="-1"></a>   <span class="at">seed =</span> <span class="dv">2021</span>)</span>
<span id="cb176-86"><a href="#cb176-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-87"><a href="#cb176-87" aria-hidden="true" tabindex="-1"></a>hist <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb176-88"><a href="#cb176-88" aria-hidden="true" tabindex="-1"></a>  train_images,</span>
<span id="cb176-89"><a href="#cb176-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">steps_per_epoch =</span> train_images<span class="sc">$</span>n <span class="sc">%/%</span> batch_size, </span>
<span id="cb176-90"><a href="#cb176-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> epochs, </span>
<span id="cb176-91"><a href="#cb176-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation_data =</span> validation_images,</span>
<span id="cb176-92"><a href="#cb176-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation_steps =</span> validation_images<span class="sc">$</span>n <span class="sc">%/%</span> batch_size,</span>
<span id="cb176-93"><a href="#cb176-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">2</span></span>
<span id="cb176-94"><a href="#cb176-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb176-95"><a href="#cb176-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-96"><a href="#cb176-96" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(test_images, </span>
<span id="cb176-97"><a href="#cb176-97" aria-hidden="true" tabindex="-1"></a>                     <span class="at">steps =</span> test_images<span class="sc">$</span>n)</span>
<span id="cb176-98"><a href="#cb176-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-99"><a href="#cb176-99" aria-hidden="true" tabindex="-1"></a><span class="do">####</span></span>
<span id="cb176-100"><a href="#cb176-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Test with new image</span></span>
<span id="cb176-101"><a href="#cb176-101" aria-hidden="true" tabindex="-1"></a>test_image <span class="ot">&lt;-</span> <span class="fu">image_load</span>(<span class="st">"barnOwltoTest.jpg"</span>,</span>
<span id="cb176-102"><a href="#cb176-102" aria-hidden="true" tabindex="-1"></a>                         <span class="at">target_size =</span> target_size)</span>
<span id="cb176-103"><a href="#cb176-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-104"><a href="#cb176-104" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">image_to_array</span>(test_image)</span>
<span id="cb176-105"><a href="#cb176-105" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">array_reshape</span>(x, <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">dim</span>(x)))</span>
<span id="cb176-106"><a href="#cb176-106" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x<span class="sc">/</span><span class="dv">255</span></span>
<span id="cb176-107"><a href="#cb176-107" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(x)</span>
<span id="cb176-108"><a href="#cb176-108" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Bird"</span> <span class="ot">=</span> label_list, <span class="st">"Probability"</span> <span class="ot">=</span> <span class="fu">t</span>(pred))</span>
<span id="cb176-109"><a href="#cb176-109" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> pred[<span class="fu">order</span>(pred<span class="sc">$</span>Probability, <span class="at">decreasing=</span>T),][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb176-110"><a href="#cb176-110" aria-hidden="true" tabindex="-1"></a>pred<span class="sc">$</span>Probability <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">format</span>(<span class="dv">100</span><span class="sc">*</span>pred<span class="sc">$</span>Probability,<span class="dv">2</span>),<span class="st">"%"</span>)</span>
<span id="cb176-111"><a href="#cb176-111" aria-hidden="true" tabindex="-1"></a>pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>